cgtsLocations={places:null,locationCount:0},cgtsLocations.initAutocomplete=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:51.507249,lng:-.127813},zoom:5,mapTypeId:"roadmap",scrollwheel:!1});var o=document.getElementById("search-input"),t=new google.maps.places.SearchBox(o);map.addListener("bounds_changed",function(){t.setBounds(map.getBounds())});var n=[];t.addListener("places_changed",function(){if(cgtsLocations.places=t.getPlaces(),0!=cgtsLocations.places.length){n.forEach(function(o){o.setMap(null)}),n=[];var o=new google.maps.LatLngBounds;cgtsLocations.places.forEach(function(t){t.geometry&&(n.push(new google.maps.Marker({map:map,title:t.name,position:t.geometry.location})),t.geometry.viewport?o.union(t.geometry.viewport):o.extend(t.geometry.location))}),$(".search-results").css("display","block"),google.maps.event.trigger(map,"resize"),map.fitBounds(o)}})},cgtsLocations.addListener=function(){$(".add").on("click",function(){name=cgtsLocations.places[0].name,lat=cgtsLocations.places[0].geometry.location.lat(),lng=cgtsLocations.places[0].geometry.location.lng(),cgtsLocations.addLocation(name,lat,lng),$(".search-results").css("display","none")})},cgtsLocations.deleteLocation=function(o,t){$(".fade").addClass("on"),$(".modal").addClass("open"),$(".modal p.location-name").text(t),$(".modal button").unbind().on("click",function(){$("#"+o).remove(),$(".location").each(function(o){existingId=parseInt($(this).attr("id").replace("location_",""),10),$(this).attr("id","location_"+o),$('*[data-location="'+existingId+'"]').attr("data-location",o),$("#locations_"+existingId+"__TEWL_ID").attr("id","locations_"+o+"__TEWL_ID"),$("#locations_"+o+"__TEWL_ID").attr("name","locations["+o+"].TEWL_ID"),$("#locations_"+existingId+"__TE_ID").attr("id","locations_"+o+"__TE_ID"),$("#locations_"+o+"__TE_ID").attr("name","locations["+o+"].TE_ID"),$("#locations_"+existingId+"__TEWL_isHome").attr("id","locations_"+o+"__TEWL_isHome"),$("#locations_"+o+"__TEWL_isHome").attr("name","locations["+o+"].TEWL_isHome"),$("#locations_"+existingId+"__TEWL_Long").attr("id","locations_"+o+"__TEWL_Long"),$("#locations_"+o+"__TEWL_Long").attr("name","locations["+o+"].TEWL_Long"),$("#locations_"+existingId+"__TEWL_Lat").attr("id","locations_"+o+"__TEWL_Lat"),$("#locations_"+o+"__TEWL_Lat").attr("name","locations["+o+"].TEWL_Lat"),$("#locations_"+existingId+"__TEWL_Name").attr("id","locations_"+o+"__TEWL_Name"),$("#locations_"+o+"__TEWL_Name").attr("name","locations["+o+"].TEWL_Name"),$("#locations_"+existingId+"__TEWL_NickName").attr("id","locations_"+o+"__TEWL_NickName"),$("#locations_"+o+"__TEWL_NickName").attr("name","locations["+o+"].TEWL_NickName")}),$(".fade").removeClass("on"),$(".modal").removeClass("open")})},cgtsLocations.addLocation=function(o,t,n){newLocation='<div id="location_'+cgtsLocations.locationCount+'" class="location">',newLocation+="<h2>"+o+'<button data-location="'+cgtsLocations.locationCount+'"></button></h2>',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TEWL_ID" name="locations['+cgtsLocations.locationCount+'].TEWL_ID" type="hidden" value="0" />',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TE_ID" name="locations['+cgtsLocations.locationCount+'].TE_ID" type="hidden" value="0" />',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TEWL_isHome" name="locations['+cgtsLocations.locationCount+'].TEWL_isHome" type="hidden" value="False" />',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TEWL_Long" name="locations['+cgtsLocations.locationCount+'].TEWL_Long" type="hidden" value="'+t+'" />',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TEWL_Lat" name="locations['+cgtsLocations.locationCount+'].TEWL_Lat" type="hidden" value="'+n+'" />',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TEWL_Name" name="locations['+cgtsLocations.locationCount+'].TEWL_Name" type="hidden" value="'+o+'" />',newLocation+='<div class="nickname cf"><label>Location nickname:</label>',newLocation+='<input id="locations_'+cgtsLocations.locationCount+'__TEWL_NickName" name="locations['+cgtsLocations.locationCount+'].TEWL_NickName" type="text" value="" placeholder="Nickname"/>',newLocation+="</div></div>",$(".locations").append(newLocation),$("#location_"+cgtsLocations.locationCount+" button").on("click",function(o){o.preventDefault(),cgtsLocations.deleteLocation("location_"+$(this).data("location"),$(this).parent().text())}),$("#search-input").val(""),cgtsLocations.locationCount++},cgtsLocations.setupLocations=function(){cgtsLocations.initAutocomplete(),cgtsLocations.addListener(),cgtsLocations.locationCount=$(".location").length,$(".locations button").on("click",function(o){o.preventDefault(),cgtsLocations.deleteLocation("location_"+$(this).data("location"),$(this).parent().text())})},$(window).load(function(){cgtsLocations.setupLocations()});